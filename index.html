<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>人生拼图</title>
    <!-- Favicon: 🧩 -->
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🧩%3C/text%3E%3C/svg%3E"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <aside class="sidebar">
        <div class="brand">🧩 人生拼图</div>
        <div id="accountPanel" class="account">
          <div id="accountStatus" class="account-status">未登录</div>
          <button id="loginBtn" class="primary block">登录 / 注册</button>
          <button id="logoutBtn" class="danger block" style="display:none">登出</button>
        </div>
        <button id="newProjectBtn" class="primary block">＋ 新建目标</button>
        <div class="projects-header">目标</div>
        <ul id="projectList" class="project-list"></ul>
      </aside>
      <main class="main">
        <div class="toolbar">
          <div id="currentProjectName" class="title">未選擇目标</div>
          <div class="progress-wrap">
            <div id="progressText">0%</div>
            <div class="progress-bar"><div id="progressBar" class="bar"></div></div>
          </div>
          <button id="deleteProjectBtn" class="danger" title="刪除目前目标" disabled>刪除目标</button>
        </div>

        <section class="puzzle-wrap">
          <div id="puzzleContainer" class="puzzle"></div>
          <div id="quoteBox" class="quote" title="每日一句"></div>
        </section>

        <section class="controls">
          <div class="control-row">
            <label>这次番茄钟推进（%）：
              <input id="sessionPercent" type="number" min="0" max="100" step="0.5" value="2" />
            </label>
            <label>计时（分钟）：
              <input id="minutesInput" type="number" min="1" max="180" step="1" value="25" />
            </label>
          </div>
          <div class="timer-row">
            <div id="timerDisplay" class="timer">25:00</div>
            <div class="buttons">
              <button id="startBtn" class="primary">开始</button>
              <button id="pauseBtn">暂停</button>
              <button id="resetBtn">重置</button>
              <button id="completeBtn" class="success" title="直接完成本次番茄鐘">完成</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- 新建目标 Modal -->
    <dialog id="newProjectDialog" class="modal">
      <form method="dialog" id="newProjectForm">
        <h3>新建目标</h3>
        <label>名稱
          <input type="text" id="projName" required placeholder="例如：寫一本書" />
        </label>
        <div class="hint">本工具固定為 100 塊（10×10）</div>
        <label>拼圖圖片
          <input type="file" id="projImage" accept="image/*" />
        </label>
        <div id="imagePreview" class="image-preview">未選擇圖片</div>
        <div class="projects-header" style="margin-top:12px">拼圖預覽</div>
        <div id="previewPuzzle" class="puzzle preview">
          <div id="previewStage" class="puzzle-stage"></div>
        </div>
        <menu>
          <button value="cancel" formnovalidate>取消</button>
          <button id="createProjectBtn" value="default" class="primary">建立</button>
        </menu>
      </form>
    </dialog>

    <!-- 登录／注册 Modal -->
    <dialog id="authDialog" class="modal">
      <form method="dialog" id="authForm">
        <h3 id="authTitle">登录</h3>
        <label>電子郵件
          <input type="email" id="authEmail" required placeholder="you@example.com" />
        </label>
        <label>密碼
          <input type="password" id="authPassword" required minlength="6" placeholder="至少 6 碼" />
        </label>
        <label id="authConfirmWrap" style="display:none">確認密碼
          <input type="password" id="authPasswordConfirm" minlength="6" placeholder="再次輸入密碼" />
        </label>
        <div id="authError" class="auth-error" style="display:none"></div>
        <div class="hint auth-hint">
          <span id="authToggleText">沒有帳號？</span>
          <button id="authToggleBtn" type="button" style="border:none;background:none;color:var(--primary);cursor:pointer;padding:0">改為注册</button>
        </div>
        <menu>
          <button value="cancel" formnovalidate>取消</button>
          <button id="authSubmitBtn" value="default" class="primary">登录</button>
        </menu>
      </form>
    </dialog>

    <!-- Firebase SDK (compat builds for non-module usage) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>
  </body>
  </html>
